openapi: 3.1.0
info:
  title: Bamboo Images API
  version: "1.0.0"
  description: Simple API for listing bamboo images and tags for a Custom GPT.

servers:
  - url: https://bamboo-images.onrender.com

paths:
  /images:
    get:
      operationId: listImages
      description: Return images from the library filtered by tags or keyword.
      parameters:
        - name: tags
          in: query
          required: false
          description: Comma-separated tags that all must be present on an image.
          schema:
            type: string
        - name: q
          in: query
          required: false
          description: Free-text search over title and tags.
          schema:
            type: string
        - name: limit
          in: query
          required: false
          description: Maximum number of images to return.
          schema:
            type: integer
            default: 8
      responses:
        "200":
          description: A list of images.
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/ImageItem"

  /search:
    get:
      operationId: searchImages
      description: Advanced search using required tags, optional tags, and keyword.
      parameters:
        - name: tags
          in: query
          required: false
          description: Comma-separated tags that must all be present.
          schema:
            type: string
        - name: any
          in: query
          required: false
          description: Comma-separated tags where at least one should match.
          schema:
            type: string
        - name: q
          in: query
          required: false
          description: Free-text keyword against id, title, and tags.
          schema:
            type: string
        - name: limit
          in: query
          required: false
          description: Maximum number of images to return.
          schema:
            type: integer
            default: 12
      responses:
        "200":
          description: Search results.
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/ImageItem"

  /tags:
    get:
      operationId: listTags
      description: List all known canonical tags and their metadata.
      responses:
        "200":
          description: Known tags and their groups.
          content:
            application/json:
              schema:
                type: object
                properties:
                  tags:
                    type: array
                    items:
                      $ref: "#/components/schemas/TagMeta"

  /health:
    get:
      operationId: healthCheck
      description: Simple health check for the Bamboo Images API.
      responses:
        "200":
          description: Health status of the API.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthStatus"

components:
  schemas:
    ImageItem:
      type: object
      properties:
        id:
          type: string
          description: Short identifier derived from the image SHA.
        url:
          type: string
          format: uri
          description: Public URL of the image file.
        title:
          type: string
          description: File name or human-readable title.
        tags:
          type: array
          description: Canonical tag keys associated with the image.
          items:
            type: string

    TagMeta:
      type: object
      properties:
        key:
          type: string
          description: Canonical tag key.
        group:
          type: string
          description: Tag group such as shape, system, material, etc.
        prompt:
          type: string
          description: Human-readable phrase for use in prompts.
        syn:
          type: array
          description: Known synonyms or loose matches for this tag.
          items:
            type: string

    HealthStatus:
      type: object
      properties:
        status:
          type: string
          description: Overall status string such as ok or degraded.
        github:
          type: object
          properties:
            ok:
              type: boolean
            detail:
              type: string
        openai_key:
          type: object
          properties:
            ok:
              type: boolean
